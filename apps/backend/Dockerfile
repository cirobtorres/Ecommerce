FROM node:20-alpine

ENV PNPM_HOME="/pnpm"
ENV PATH="$PNPM_HOME:$PATH"

RUN apk add --no-cache libc6-compat bash openssl && \
    corepack enable && \
    pnpm install turbo --global

WORKDIR /app

# Copiando arquivos para a imagem
COPY turbo.json .
COPY package.json ./
COPY pnpm-workspace.yaml ./
COPY apps/backend/package.json apps/backend/
COPY apps/web/package.json apps/web/
COPY packages ./packages
COPY apps/backend ./apps/backend

# Instalando dependÃªncias
RUN pnpm install --prefer-offline

# Torna init.sh executÃ¡vel
RUN chmod +x apps/backend/init.sh && echo "âœ… init.sh marcado como executÃ¡vel."

WORKDIR /app/apps/backend

EXPOSE 3000

CMD echo "ðŸš€ Executando init.sh..." && bash ./init.sh
